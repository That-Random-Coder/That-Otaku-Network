<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Groups - Temp (Standalone)</title>
    <style>
      /* Minimal styles to match the original look & feel */
      :root {
        --bg1: #0f1724;
        --card: rgba(116, 16, 16, 0.05);
        --muted: #cbd5e1;
      }
      body {
        margin: 0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
        min-height: 100vh;
        background: linear-gradient(135deg, #451b3e, #3a2b6a, #1f4b73);
        color: #fff;
        -webkit-font-smoothing: antialiased;
      }
      .wrap {
        max-width: 1000px;
        margin: 48px auto;
        padding: 20px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      h1 {
        margin: 0;
        font-size: 28px;
      }
      p.lead {
        margin: 4px 0 0;
        color: rgba(255, 255, 255, 0.85);
        font-size: 14px;
      }
      button.btn {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: #fff;
        padding: 8px 12px;
        border-radius: 999px;
        cursor: pointer;
      }
      .btn-group {
        display: flex;
        gap: 10px;
      }
      .grid {
        margin-top: 20px;
        display: grid;
        gap: 14px;
      }
      .card {
        background: var(--card);
        border-radius: 20px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .group-info {
        display: flex;
        align-items: center;
        gap: 14px;
      }
      .avatar {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
      }
      .muted {
        color: rgba(255, 255, 255, 0.75);
        font-size: 13px;
      }

      /* Modal */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .modal {
        width: 100%;
        max-width: 760px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border-radius: 20px;
        padding: 18px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #e6eef6;
      }
      input[type="text"],
      textarea {
        width: 100%;
        padding: 10px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(0, 0, 0, 0.25);
        color: #fff;
      }
      .row {
        display: flex;
        gap: 12px;
      }
      .file-preview {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-top: 8px;
      }
      .file-preview img {
        width: 64px;
        height: 64px;
        border-radius: 8px;
        object-fit: cover;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 14px;
      }
      .alert {
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
      }
      .alert.success {
        background: linear-gradient(
          90deg,
          rgba(34, 197, 94, 0.12),
          rgba(16, 185, 129, 0.06)
        );
        border: 1px solid rgba(34, 197, 94, 0.12);
        color: #bbf7d0;
      }
      .alert.error {
        background: linear-gradient(
          90deg,
          rgba(239, 68, 68, 0.08),
          rgba(249, 115, 22, 0.04)
        );
        border: 1px solid rgba(239, 68, 68, 0.08);
        color: #ffd7d7;
      }
      .hidden {
        display: none;
      }
      small.hint {
        color: rgba(255, 255, 255, 0.6);
      }
      /* API Tester Section */
      .api-tester {
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .api-tester h3 {
        margin: 0 0 15px 0;
        font-size: 18px;
      }
      .api-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 10px;
      }
      .api-btn {
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 13px;
        text-align: left;
        transition: transform 0.1s;
      }
      .api-btn:hover {
        transform: scale(1.02);
      }
      .api-btn.get {
        background: linear-gradient(135deg, #059669, #0d9488);
      }
      .api-btn.post {
        background: linear-gradient(135deg, #2563eb, #7c3aed);
      }
      .api-btn.put {
        background: linear-gradient(135deg, #d97706, #ea580c);
      }
      .api-btn.delete {
        background: linear-gradient(135deg, #dc2626, #be123c);
      }
      .method-tag {
        display: inline-block;
        font-size: 10px;
        font-weight: 700;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.3);
        margin-bottom: 4px;
      }
      .result-box {
        margin-top: 15px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }
      /* JWT/ID Selector */
      .jwt-selector {
        margin-top: 20px;
        padding: 16px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .jwt-selector h3 {
        margin: 0 0 12px 0;
        font-size: 16px;
      }
      .user-select-btn {
        padding: 10px 16px;
        border-radius: 10px;
        margin-right: 10px;
        margin-bottom: 8px;
        font-size: 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.2s;
      }
      .user-select-btn:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .user-select-btn.active {
        background: linear-gradient(135deg, #6b21a8, #0ea5b5);
        border-color: transparent;
      }
      .current-user-info {
        margin-top: 10px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        font-family: monospace;
        font-size: 11px;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <p class="muted">Communities</p>
          <h1>Groups</h1>
          <p class="lead">
            Join active groups to host watch parties, meetups, and themed
            discussions.
          </p>
        </div>
        <div class="btn-group">
          <button
            id="open-user"
            class="btn"
            style="background: linear-gradient(90deg, #0ea5b5, #6b21a8)"
          >
            + Create User
          </button>
          <button id="open-create" class="btn">+ Create group</button>
        </div>
      </header>

      <div class="grid" id="groups-list"></div>

      <!-- JWT/ID Selector Section -->
      <div class="jwt-selector">
        <h3>üîë Active User & JWT</h3>
        <div>
          <button
            id="select-user1"
            class="btn user-select-btn active"
            onclick="switchUser('user1')"
          >
            User 1 (79e4aef7...)
          </button>
          <button
            id="select-user2"
            class="btn user-select-btn"
            onclick="switchUser('user2')"
          >
            User 2 (8f23bdad...)
          </button>
        </div>
        <div id="current-user-display" class="current-user-info">
          Active: User 1 (79e4aef7...)
        </div>
      </div>

      <!-- Group API Tester Section -->
      <div class="api-tester">
        <h3>üß™ Group API Tester</h3>
        <div class="api-grid">
          <button class="btn api-btn get" id="api-get-group">
            <span class="method-tag">GET</span><br />Get Group
          </button>
          <button class="btn api-btn post" id="api-join-group">
            <span class="method-tag">POST</span><br />Join Group
          </button>
          <button class="btn api-btn post" id="api-leave-group">
            <span class="method-tag">POST</span><br />Leave Group
          </button>
          <button class="btn api-btn put" id="api-update-bio">
            <span class="method-tag">PUT</span><br />Update Bio
          </button>
          <button class="btn api-btn put" id="api-update-images">
            <span class="method-tag">PUT</span><br />Update Images
          </button>
          <button class="btn api-btn put" id="api-change-leader">
            <span class="method-tag">PUT</span><br />Change Leader
          </button>
          <button class="btn api-btn delete" id="api-delete-group">
            <span class="method-tag">DELETE</span><br />Delete Group
          </button>
        </div>
        <div id="api-result" class="result-box hidden"></div>
      </div>

      <!-- User API Tester Section -->
      <div class="api-tester">
        <h3>üë§ User API Tester</h3>
        <div class="api-grid">
          <button class="btn api-btn get" id="api-get-user">
            <span class="method-tag">GET</span><br />Get User
          </button>
          <button class="btn api-btn post" id="api-follow-user">
            <span class="method-tag">POST</span><br />Follow User
          </button>
          <button class="btn api-btn delete" id="api-unfollow-user">
            <span class="method-tag">DELETE</span><br />Unfollow User
          </button>
          <button class="btn api-btn get" id="api-get-followers">
            <span class="method-tag">GET</span><br />Get Followers
          </button>
          <button class="btn api-btn get" id="api-get-following">
            <span class="method-tag">GET</span><br />Get Following
          </button>
          <button class="btn api-btn put" id="api-update-profile">
            <span class="method-tag">PUT</span><br />Update Profile
          </button>
          <button class="btn api-btn put" id="api-update-user-image">
            <span class="method-tag">PUT</span><br />Update Image
          </button>
        </div>
        <div id="user-api-result" class="result-box hidden"></div>
      </div>
    </div>

    <!-- Get Group Modal -->
    <div id="get-group-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Get Group</h2>
            <small class="hint">Retrieve group details by ID</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="get-group-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input id="get-group-id" type="text" placeholder="Group UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label
            ><input type="checkbox" id="get-group-image" /> Include
            Images</label
          >
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="get-group-submit"
            class="btn"
            style="background: linear-gradient(135deg, #059669, #0d9488)"
          >
            Get Group
          </button>
        </div>
      </div>
    </div>

    <!-- Join Group Modal -->
    <div id="join-group-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Join Group</h2>
            <small class="hint">Add a user to a group</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="join-group-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input id="join-group-id" type="text" placeholder="Group UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input id="join-user-id" type="text" placeholder="User UUID" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="join-group-submit"
            class="btn"
            style="background: linear-gradient(135deg, #2563eb, #7c3aed)"
          >
            Join
          </button>
        </div>
      </div>
    </div>

    <!-- Leave Group Modal -->
    <div id="leave-group-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Leave Group</h2>
            <small class="hint">Remove a user from a group</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="leave-group-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input id="leave-group-id" type="text" placeholder="Group UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input id="leave-user-id" type="text" placeholder="User UUID" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="leave-group-submit"
            class="btn"
            style="background: linear-gradient(135deg, #2563eb, #7c3aed)"
          >
            Leave
          </button>
        </div>
      </div>
    </div>

    <!-- Update Bio Modal -->
    <div id="update-bio-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Update Group Bio</h2>
            <small class="hint">Change the group's bio/description</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="update-bio-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input
            id="update-bio-group-id"
            type="text"
            placeholder="Group UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>New Bio</label>
          <textarea
            id="update-bio-text"
            rows="3"
            placeholder="New group bio..."
          ></textarea>
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="update-bio-submit"
            class="btn"
            style="background: linear-gradient(135deg, #d97706, #ea580c)"
          >
            Update
          </button>
        </div>
      </div>
    </div>

    <!-- Update Images Modal -->
    <div id="update-images-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Update Group Images</h2>
            <small class="hint">Change profile and/or background image</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="update-images-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input
            id="update-images-group-id"
            type="text"
            placeholder="Group UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Profile Image</label>
          <input id="update-profile-image" type="file" accept="image/*" />
        </div>
        <div style="margin-bottom: 10px">
          <label>Background Image</label>
          <input id="update-bg-image" type="file" accept="image/*" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="update-images-submit"
            class="btn"
            style="background: linear-gradient(135deg, #d97706, #ea580c)"
          >
            Update
          </button>
        </div>
      </div>
    </div>

    <!-- Change Leader Modal -->
    <div id="change-leader-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Change Group Leader</h2>
            <small class="hint">Transfer leadership to another member</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="change-leader-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input
            id="change-leader-group-id"
            type="text"
            placeholder="Group UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Current Leader ID (UUID)</label>
          <input
            id="change-leader-current-id"
            type="text"
            placeholder="Current Leader UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>New Leader ID (UUID)</label>
          <input
            id="change-leader-new-id"
            type="text"
            placeholder="New Leader UUID"
          />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="change-leader-submit"
            class="btn"
            style="background: linear-gradient(135deg, #d97706, #ea580c)"
          >
            Change Leader
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Group Modal -->
    <div id="delete-group-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Delete Group</h2>
            <small class="hint">‚ö†Ô∏è This action cannot be undone</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="delete-group-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Group ID (UUID)</label>
          <input id="delete-group-id" type="text" placeholder="Group UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label>Leader ID (UUID)</label>
          <input
            id="delete-leader-id"
            type="text"
            placeholder="Leader UUID (for authorization)"
          />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="delete-group-submit"
            class="btn"
            style="background: linear-gradient(135deg, #dc2626, #be123c)"
          >
            Delete Group
          </button>
        </div>
      </div>
    </div>

    <!-- Get User Modal -->
    <div id="get-user-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Get User</h2>
            <small class="hint">Retrieve user profile by ID</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="get-user-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input id="get-user-id" type="text" placeholder="User UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label
            ><input type="checkbox" id="get-user-image" /> Include Image</label
          >
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="get-user-submit"
            class="btn"
            style="background: linear-gradient(135deg, #059669, #0d9488)"
          >
            Get User
          </button>
        </div>
      </div>
    </div>

    <!-- Follow User Modal -->
    <div id="follow-user-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Follow User</h2>
            <small class="hint">Follow another user</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="follow-user-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Your User ID (UUID)</label>
          <input id="follow-user-id" type="text" placeholder="Your UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label>Target User ID (UUID)</label>
          <input
            id="follow-target-id"
            type="text"
            placeholder="User to follow UUID"
          />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="follow-user-submit"
            class="btn"
            style="background: linear-gradient(135deg, #2563eb, #7c3aed)"
          >
            Follow
          </button>
        </div>
      </div>
    </div>

    <!-- Unfollow User Modal -->
    <div id="unfollow-user-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Unfollow User</h2>
            <small class="hint">Unfollow a user</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="unfollow-user-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>Your User ID (UUID)</label>
          <input id="unfollow-user-id" type="text" placeholder="Your UUID" />
        </div>
        <div style="margin-bottom: 10px">
          <label>Target User ID (UUID)</label>
          <input
            id="unfollow-target-id"
            type="text"
            placeholder="User to unfollow UUID"
          />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="unfollow-user-submit"
            class="btn"
            style="background: linear-gradient(135deg, #dc2626, #be123c)"
          >
            Unfollow
          </button>
        </div>
      </div>
    </div>

    <!-- Get Followers Modal -->
    <div id="get-followers-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Get Followers</h2>
            <small class="hint">Get list of followers for a user</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="get-followers-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input
            id="get-followers-user-id"
            type="text"
            placeholder="User UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Page Number</label>
          <input id="get-followers-page" type="number" value="0" min="0" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="get-followers-submit"
            class="btn"
            style="background: linear-gradient(135deg, #059669, #0d9488)"
          >
            Get Followers
          </button>
        </div>
      </div>
    </div>

    <!-- Get Following Modal -->
    <div id="get-following-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Get Following</h2>
            <small class="hint">Get list of users being followed</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="get-following-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input
            id="get-following-user-id"
            type="text"
            placeholder="User UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Page Number</label>
          <input id="get-following-page" type="number" value="0" min="0" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="get-following-submit"
            class="btn"
            style="background: linear-gradient(135deg, #059669, #0d9488)"
          >
            Get Following
          </button>
        </div>
      </div>
    </div>

    <!-- Update User Profile Modal -->
    <div id="update-user-profile-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Update User Profile</h2>
            <small class="hint">Update user profile details</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="update-user-profile-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input
            id="update-profile-user-id"
            type="text"
            placeholder="User UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Display Name (optional)</label>
          <input
            id="update-profile-displayname"
            type="text"
            placeholder="New display name"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Bio (optional)</label>
          <textarea
            id="update-profile-bio"
            rows="2"
            placeholder="New bio..."
          ></textarea>
        </div>
        <div style="margin-bottom: 10px">
          <label>Location (optional)</label>
          <input
            id="update-profile-location"
            type="text"
            placeholder="New location"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Date of Birth (optional)</label>
          <input id="update-profile-dob" type="date" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="update-user-profile-submit"
            class="btn"
            style="background: linear-gradient(135deg, #d97706, #ea580c)"
          >
            Update Profile
          </button>
        </div>
      </div>
    </div>

    <!-- Update User Image Modal -->
    <div id="update-user-image-modal" class="modal-backdrop hidden">
      <div class="modal">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 style="margin: 0">Update User Image</h2>
            <small class="hint">Update profile image</small>
          </div>
          <div><button class="btn modal-close-btn">‚úï</button></div>
        </div>
        <div id="update-user-image-msg" class="hidden"></div>
        <div style="margin-bottom: 10px">
          <label>User ID (UUID)</label>
          <input
            id="update-user-image-id"
            type="text"
            placeholder="User UUID"
          />
        </div>
        <div style="margin-bottom: 10px">
          <label>Profile Image</label>
          <input id="update-user-image-file" type="file" accept="image/*" />
        </div>
        <div class="footer">
          <button class="btn modal-close-btn">Cancel</button>
          <button
            id="update-user-image-submit"
            class="btn"
            style="background: linear-gradient(135deg, #d97706, #ea580c)"
          >
            Update Image
          </button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal-backdrop hidden" aria-hidden="true">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
      >
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 id="modal-title" style="margin: 0">Create a Group</h2>
            <small class="hint"
              >Set a name, bio, icon, and background for your group.</small
            >
          </div>
          <div><button id="close-create" class="btn">‚úï</button></div>
        </div>

        <div id="api-message" class="hidden"></div>

        <div>
          <div style="margin-bottom: 10px">
            <label>Group Name</label>
            <input id="group-name" type="text" placeholder="Group name" />
          </div>

          <div style="margin-bottom: 10px">
            <label>Group Bio</label>
            <textarea
              id="group-bio"
              rows="3"
              placeholder="Short description..."
            ></textarea>
          </div>

          <div style="margin-bottom: 10px">
            <label>Group Icon (image)</label>
            <input id="group-icon" type="file" accept="image/*" />
            <div id="icon-preview" class="file-preview hidden"></div>
          </div>

          <div style="margin-bottom: 10px">
            <label>Group Background (image)</label>
            <input id="group-bg" type="file" accept="image/*" />
            <div id="bg-preview" class="file-preview hidden"></div>
          </div>

          <div id="file-error" class="alert error hidden"></div>

          <div class="footer">
            <button id="cancel-create" class="btn">Cancel</button>
            <button
              id="submit-create"
              class="btn"
              style="background: linear-gradient(90deg, #6b21a8, #0ea5b5)"
            >
              Create
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Modal -->
    <div id="user-modal" class="modal-backdrop hidden" aria-hidden="true">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="user-modal-title"
      >
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          "
        >
          <div>
            <h2 id="user-modal-title" style="margin: 0">Create a User</h2>
            <small class="hint">Create a new user profile for testing.</small>
          </div>
          <div><button id="close-user" class="btn">‚úï</button></div>
        </div>

        <div id="user-api-message" class="hidden"></div>

        <div>
          <div style="margin-bottom: 10px">
            <label>User ID (UUID)</label>
            <input
              id="user-id"
              type="text"
              placeholder="e.g., 79e4aef7-914f-468f-8d86-4c9869773b9c"
            />
            <button
              id="generate-uuid"
              class="btn"
              style="margin-top: 5px; font-size: 12px"
            >
              Generate UUID
            </button>
          </div>

          <div style="margin-bottom: 10px">
            <label>Username</label>
            <input
              id="user-username"
              type="text"
              placeholder="alphanumeric and underscore only"
            />
          </div>

          <div style="margin-bottom: 10px">
            <label>Display Name</label>
            <input
              id="user-displayname"
              type="text"
              placeholder="Your display name"
            />
          </div>

          <div style="margin-bottom: 10px">
            <label>Bio</label>
            <textarea
              id="user-bio"
              rows="2"
              placeholder="Short bio..."
            ></textarea>
          </div>

          <div style="margin-bottom: 10px">
            <label>Location</label>
            <input id="user-location" type="text" placeholder="City, Country" />
          </div>

          <div style="margin-bottom: 10px">
            <label>Date of Birth</label>
            <input id="user-dob" type="date" />
          </div>

          <div style="margin-bottom: 10px">
            <label>Profile Image</label>
            <input id="user-image" type="file" accept="image/*" />
            <div id="user-image-preview" class="file-preview hidden"></div>
          </div>

          <div id="user-file-error" class="alert error hidden"></div>

          <div class="footer">
            <button id="cancel-user" class="btn">Cancel</button>
            <button
              id="submit-user"
              class="btn"
              style="background: linear-gradient(90deg, #0ea5b5, #6b21a8)"
            >
              Create User
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Configuration: using the user-provided id and bearer token
      const TOKENS = {
        user1: {
          id: "79e4aef7-914f-468f-8d86-4c9869773b9c",
          token:
            "eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiVVNFUiIsInR5cGUiOiJBQ0NFU1MiLCJzdWIiOiI3OWU0YWVmNy05MTRmLTQ2OGYtOGQ4Ni00Yzk4Njk3NzNiOWMiLCJpYXQiOjE3NjY0OTg2OTUsImV4cCI6MTc2OTA5MDY5NX0.FzFgNYHw8rXNFqsAxlPIpvCmEXzewlloo-nG5ueJGVg",
          label: "User 1 (79e4aef7...)",
        },
        user2: {
          id: "8f23bdad-1514-48ba-bb2b-496c3eae6774",
          token:
            "eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiVVNFUiIsInR5cGUiOiJBQ0NFU1MiLCJzdWIiOiI4ZjIzYmRhZC0xNTE0LTQ4YmEtYmIyYi00OTZjM2VhZTY3NzQiLCJpYXQiOjE3NjYzOTY0MjgsImV4cCI6MTc2ODk4ODQyOH0.WsxYEtj2-gXTxbNjeKuFcj-V8hzIQVd7f3UZ1PvPh98",
          label: "User 2 (8f23bdad...)",
        },
      };

      let currentUser = "user1";
      const LEADER_ID = TOKENS[currentUser].id;
      let BEARER_TOKEN = TOKENS[currentUser].token;

      function getCurrentUserId() {
        return TOKENS[currentUser].id;
      }

      function getCurrentToken() {
        return TOKENS[currentUser].token;
      }

      function switchUser(userKey) {
        currentUser = userKey;
        BEARER_TOKEN = TOKENS[userKey].token;
        updateActiveUserDisplay();
      }

      function updateActiveUserDisplay() {
        document.querySelectorAll(".user-select-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        const activeBtn = document.getElementById("select-" + currentUser);
        if (activeBtn) activeBtn.classList.add("active");
        const display = document.getElementById("current-user-display");
        if (display)
          display.textContent = `Active: ${TOKENS[currentUser].label}`;
      }

      // Seed groups to display initially
      const seedGroups = [
        { id: "g1", name: "Shonen Shapers", members: 1240, activity: "Daily" },
        {
          id: "g2",
          name: "Studio Ghibli Fans",
          members: 842,
          activity: "Weekly",
        },
        { id: "g3", name: "Retro Otaku", members: 312, activity: "Monthly" },
        {
          id: "g4",
          name: "Cosplay Creators",
          members: 540,
          activity: "Weekly",
        },
        {
          id: "g5",
          name: "Silent Protagonists",
          members: 78,
          activity: "Occasional",
        },
      ];

      const maxFileSize = 5 * 1024 * 1024; // 5 MB

      const el = (id) => document.getElementById(id);

      // Render group list
      const renderGroups = (groups) => {
        const container = el("groups-list");
        container.innerHTML = "";
        groups.forEach((g) => {
          const d = document.createElement("div");
          d.className = "card";
          d.innerHTML = `
          <div class="group-info">
            <div class="avatar">${escapeHtml(g.name.slice(0, 2))}</div>
            <div>
              <div style="font-weight:700">${escapeHtml(g.name)}</div>
              <div class="muted">${g.members} members ¬∑ ${escapeHtml(
            g.activity
          )}</div>
            </div>
          </div>
          <div>
            <button class="btn" style="border-radius:12px;padding:6px 10px">Join</button>
          </div>
        `;
          container.appendChild(d);
        });
      };

      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      // Modal controls
      const modal = el("modal");
      const openBtn = el("open-create");
      const closeBtn = el("close-create");
      const cancelBtn = el("cancel-create");
      const submitBtn = el("submit-create");
      const apiMsg = el("api-message");
      const fileError = el("file-error");

      const groupName = el("group-name");
      const groupBio = el("group-bio");
      const groupIcon = el("group-icon");
      const groupBg = el("group-bg");
      const iconPreview = el("icon-preview");
      const bgPreview = el("bg-preview");

      let iconFile = null;
      let bgFile = null;

      openBtn.addEventListener("click", () => {
        showModal();
      });
      closeBtn.addEventListener("click", hideModal);
      cancelBtn.addEventListener("click", hideModal);

      // file handling
      groupIcon.addEventListener("change", (e) => {
        fileError.classList.add("hidden");
        const f = e.target.files && e.target.files[0];
        if (!f) {
          iconFile = null;
          iconPreview.classList.add("hidden");
          iconPreview.innerHTML = "";
          return;
        }
        if (f.size > maxFileSize) {
          showFileError("Icon file exceeds 5 MB limit.");
          groupIcon.value = "";
          return;
        }
        iconFile = f;
        readAndPreview(f, iconPreview);
      });

      groupBg.addEventListener("change", (e) => {
        fileError.classList.add("hidden");
        const f = e.target.files && e.target.files[0];
        if (!f) {
          bgFile = null;
          bgPreview.classList.add("hidden");
          bgPreview.innerHTML = "";
          return;
        }
        if (f.size > maxFileSize) {
          showFileError("Background file exceeds 5 MB limit.");
          groupBg.value = "";
          return;
        }
        bgFile = f;
        readAndPreview(f, bgPreview);
      });

      function showFileError(msg) {
        fileError.textContent = msg;
        fileError.classList.remove("hidden");
      }

      function readAndPreview(file, targetEl) {
        const reader = new FileReader();
        reader.onload = () => {
          targetEl.classList.remove("hidden");
          targetEl.innerHTML = `<img src="${reader.result}" alt="preview"><div class="muted">Image selected</div>`;
        };
        reader.readAsDataURL(file);
      }

      function showModal() {
        modal.classList.remove("hidden");
        apiMsg.classList.add("hidden");
        fileError.classList.add("hidden");
        groupName.value = "";
        groupBio.value = "";
        groupIcon.value = "";
        groupBg.value = "";
        iconPreview.classList.add("hidden");
        iconPreview.innerHTML = "";
        bgPreview.classList.add("hidden");
        bgPreview.innerHTML = "";
        iconFile = null;
        bgFile = null;
      }

      function hideModal() {
        modal.classList.add("hidden");
      }

      function showApiMessage(type, message) {
        apiMsg.className = "";
        apiMsg.classList.add("alert");
        apiMsg.classList.add(type === "success" ? "success" : "error");
        apiMsg.classList.remove("hidden");
        apiMsg.textContent = message;
        // auto hide after 5s
        setTimeout(() => apiMsg.classList.add("hidden"), 5000);
      }

      submitBtn.addEventListener("click", async () => {
        fileError.classList.add("hidden");
        apiMsg.classList.add("hidden");
        const name = groupName.value.trim();
        const bio = groupBio.value.trim();
        if (!name || !bio || !iconFile || !bgFile) {
          showApiMessage("error", "All fields are required.");
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = "Creating...";

        try {
          const dto = {
            groupName: name,
            groupBio: bio,
            leaderId: getCurrentUserId(),
          };
          const formData = new FormData();
          formData.append(
            "requestDto",
            new Blob([JSON.stringify(dto)], { type: "application/json" })
          );
          formData.append("profileImage", iconFile);
          formData.append("bgImage", bgFile);

          const url = "http://localhost:11111/api/profile/group/create";
          console.log(
            "POST",
            url,
            "Authorization present:",
            !!getCurrentToken()
          );

          const res = await fetch(url, {
            method: "POST",
            body: formData,
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok) {
            // If server returns an error structure, try to show it
            const msg =
              (body && (body.message || (body.error && body.error.message))) ||
              "Failed to create group (status " + res.status + ")";
            throw new Error(msg);
          }
          const created = (body && (body.data || body)) || {};
          showApiMessage("success", "Group created");
          // add to UI list
          seedGroups.unshift({
            id: created.id || "g" + Date.now(),
            name,
            members: 1,
            activity: "Now",
          });
          renderGroups(seedGroups);
          // close modal shortly
          setTimeout(hideModal, 800);
        } catch (err) {
          console.error(err);
          showApiMessage("error", err.message || "Failed to create group");
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Create";
        }
      });

      // initial render
      renderGroups(seedGroups);

      // Close modal when clicking backdrop
      modal.addEventListener("click", (e) => {
        if (e.target === modal) hideModal();
      });

      // ==================== CREATE USER FUNCTIONALITY ====================
      const userModal = el("user-modal");
      const openUserBtn = el("open-user");
      const closeUserBtn = el("close-user");
      const cancelUserBtn = el("cancel-user");
      const submitUserBtn = el("submit-user");
      const userApiMsg = el("user-api-message");
      const userFileError = el("user-file-error");
      const generateUuidBtn = el("generate-uuid");

      const userId = el("user-id");
      const userUsername = el("user-username");
      const userDisplayname = el("user-displayname");
      const userBio = el("user-bio");
      const userLocation = el("user-location");
      const userDob = el("user-dob");
      const userImage = el("user-image");
      const userImagePreview = el("user-image-preview");

      let userImageFile = null;

      openUserBtn.addEventListener("click", () => {
        showUserModal();
      });
      closeUserBtn.addEventListener("click", hideUserModal);
      cancelUserBtn.addEventListener("click", hideUserModal);

      // Generate UUID
      generateUuidBtn.addEventListener("click", () => {
        userId.value = crypto.randomUUID();
      });

      // User image handling
      userImage.addEventListener("change", (e) => {
        userFileError.classList.add("hidden");
        const f = e.target.files && e.target.files[0];
        if (!f) {
          userImageFile = null;
          userImagePreview.classList.add("hidden");
          userImagePreview.innerHTML = "";
          return;
        }
        if (f.size > maxFileSize) {
          showUserFileError("Image file exceeds 5 MB limit.");
          userImage.value = "";
          return;
        }
        userImageFile = f;
        readAndPreviewUser(f, userImagePreview);
      });

      function showUserFileError(msg) {
        userFileError.textContent = msg;
        userFileError.classList.remove("hidden");
      }

      function readAndPreviewUser(file, targetEl) {
        const reader = new FileReader();
        reader.onload = () => {
          targetEl.classList.remove("hidden");
          targetEl.innerHTML = `<img src="${reader.result}" alt="preview"><div class="muted">Image selected</div>`;
        };
        reader.readAsDataURL(file);
      }

      function showUserModal() {
        userModal.classList.remove("hidden");
        userApiMsg.classList.add("hidden");
        userFileError.classList.add("hidden");
        userId.value = "";
        userUsername.value = "";
        userDisplayname.value = "";
        userBio.value = "";
        userLocation.value = "";
        userDob.value = "";
        userImage.value = "";
        userImagePreview.classList.add("hidden");
        userImagePreview.innerHTML = "";
        userImageFile = null;
      }

      function hideUserModal() {
        userModal.classList.add("hidden");
      }

      function showUserApiMessage(type, message) {
        userApiMsg.className = "";
        userApiMsg.classList.add("alert");
        userApiMsg.classList.add(type === "success" ? "success" : "error");
        userApiMsg.classList.remove("hidden");
        userApiMsg.textContent = message;
        setTimeout(() => userApiMsg.classList.add("hidden"), 5000);
      }

      submitUserBtn.addEventListener("click", async () => {
        userFileError.classList.add("hidden");
        userApiMsg.classList.add("hidden");

        const id = userId.value.trim();
        const username = userUsername.value.trim();
        const displayName = userDisplayname.value.trim();
        const bio = userBio.value.trim();
        const location = userLocation.value.trim();
        const dateOfBirth = userDob.value;

        // Validate required fields
        if (
          !id ||
          !username ||
          !displayName ||
          !bio ||
          !location ||
          !userImageFile
        ) {
          showUserApiMessage(
            "error",
            "All fields are required (id, username, displayName, bio, location, and image)."
          );
          return;
        }

        // Validate UUID format
        const uuidRegex =
          /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
        if (!uuidRegex.test(id)) {
          showUserApiMessage("error", "Invalid UUID format.");
          return;
        }

        // Validate username format
        const usernameRegex = /^[a-zA-Z0-9_]+$/;
        if (!usernameRegex.test(username)) {
          showUserApiMessage(
            "error",
            "Username can only contain alphanumeric characters and underscores."
          );
          return;
        }

        submitUserBtn.disabled = true;
        submitUserBtn.textContent = "Creating...";

        try {
          const dto = {
            id: id,
            username: username,
            displayName: displayName,
            bio: bio,
            location: location,
            dateOfBirth: dateOfBirth || null,
          };

          const formData = new FormData();
          formData.append(
            "requestDto",
            new Blob([JSON.stringify(dto)], { type: "application/json" })
          );
          formData.append("file", userImageFile);

          const url = "http://localhost:11111/api/profile/user/profile/create";
          console.log("POST", url);

          const res = await fetch(url, {
            method: "POST",
            body: formData,
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });

          const body = await res.json().catch(() => ({}));
          if (!res.ok) {
            const msg =
              (body && (body.message || (body.error && body.error.message))) ||
              "Failed to create user (status " + res.status + ")";
            throw new Error(msg);
          }

          const created = (body && (body.data || body)) || {};
          showUserApiMessage(
            "success",
            `User created successfully! ID: ${created.id || id}`
          );
          console.log("Created user:", created);

          // Close modal shortly
          setTimeout(hideUserModal, 1500);
        } catch (err) {
          console.error(err);
          showUserApiMessage("error", err.message || "Failed to create user");
        } finally {
          submitUserBtn.disabled = false;
          submitUserBtn.textContent = "Create User";
        }
      });

      // Close user modal when clicking backdrop
      userModal.addEventListener("click", (e) => {
        if (e.target === userModal) hideUserModal();
      });

      // ==================== GROUP API TESTER FUNCTIONALITY ====================
      const apiResult = el("api-result");
      const BASE_URL = "http://localhost:11111/api/profile";

      // Helper functions
      function showResult(data, isError = false) {
        apiResult.classList.remove("hidden");
        apiResult.style.color = isError ? "#fca5a5" : "#86efac";
        apiResult.textContent =
          typeof data === "string" ? data : JSON.stringify(data, null, 2);
      }

      function showModalMsg(msgEl, type, message) {
        msgEl.className = "";
        msgEl.classList.add("alert", type === "success" ? "success" : "error");
        msgEl.classList.remove("hidden");
        msgEl.textContent = message;
        setTimeout(() => msgEl.classList.add("hidden"), 5000);
      }

      // Generic modal handlers
      document.querySelectorAll(".modal-close-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.target.closest(".modal-backdrop").classList.add("hidden");
        });
      });

      document.querySelectorAll(".modal-backdrop").forEach((modal) => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) modal.classList.add("hidden");
        });
      });

      // GET Group
      el("api-get-group").addEventListener("click", () => {
        el("get-group-modal").classList.remove("hidden");
        el("get-group-id").value = "";
        el("get-group-image").checked = false;
      });

      el("get-group-submit").addEventListener("click", async () => {
        const groupId = el("get-group-id").value.trim();
        const includeImage = el("get-group-image").checked;
        const msgEl = el("get-group-msg");

        if (!groupId) {
          showModalMsg(msgEl, "error", "Group ID is required");
          return;
        }

        try {
          const url = `${BASE_URL}/group/get?id=${groupId}&image=${includeImage}`;
          const res = await fetch(url, {
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json();
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showResult(body);
          showModalMsg(msgEl, "success", "Group retrieved successfully!");
          setTimeout(() => el("get-group-modal").classList.add("hidden"), 800);
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // JOIN Group
      el("api-join-group").addEventListener("click", () => {
        el("join-group-modal").classList.remove("hidden");
        el("join-group-id").value = "";
        el("join-user-id").value = getCurrentUserId();
      });

      el("join-group-submit").addEventListener("click", async () => {
        const groupId = el("join-group-id").value.trim();
        const userId = el("join-user-id").value.trim();
        const msgEl = el("join-group-msg");

        if (!groupId || !userId) {
          showModalMsg(
            msgEl,
            "error",
            "Both Group ID and User ID are required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/group/join?groupId=${groupId}&userId=${userId}`;
          const res = await fetch(url, {
            method: "POST",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body.message || `Failed (${res.status})`);
          }
          showResult("Successfully joined the group!");
          showModalMsg(msgEl, "success", "Joined group successfully!");
          setTimeout(() => el("join-group-modal").classList.add("hidden"), 800);
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // LEAVE Group
      el("api-leave-group").addEventListener("click", () => {
        el("leave-group-modal").classList.remove("hidden");
        el("leave-group-id").value = "";
        el("leave-user-id").value = getCurrentUserId();
      });

      el("leave-group-submit").addEventListener("click", async () => {
        const groupId = el("leave-group-id").value.trim();
        const userId = el("leave-user-id").value.trim();
        const msgEl = el("leave-group-msg");

        if (!groupId || !userId) {
          showModalMsg(
            msgEl,
            "error",
            "Both Group ID and User ID are required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/group/leave?groupId=${groupId}&userId=${userId}`;
          const res = await fetch(url, {
            method: "POST",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body.message || `Failed (${res.status})`);
          }
          showResult("Successfully left the group!");
          showModalMsg(msgEl, "success", "Left group successfully!");
          setTimeout(
            () => el("leave-group-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // UPDATE Bio
      el("api-update-bio").addEventListener("click", () => {
        el("update-bio-modal").classList.remove("hidden");
        el("update-bio-group-id").value = "";
        el("update-bio-text").value = "";
      });

      el("update-bio-submit").addEventListener("click", async () => {
        const groupId = el("update-bio-group-id").value.trim();
        const bio = el("update-bio-text").value.trim();
        const msgEl = el("update-bio-msg");

        if (!groupId || !bio) {
          showModalMsg(msgEl, "error", "Group ID and Bio are required");
          return;
        }

        try {
          const url = `${BASE_URL}/group/bio/update`;
          const res = await fetch(url, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + getCurrentToken(),
            },
            body: JSON.stringify({ id: groupId, bio: bio }),
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showResult(body);
          showModalMsg(msgEl, "success", "Bio updated successfully!");
          setTimeout(() => el("update-bio-modal").classList.add("hidden"), 800);
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // UPDATE Images
      el("api-update-images").addEventListener("click", () => {
        el("update-images-modal").classList.remove("hidden");
        el("update-images-group-id").value = "";
        el("update-profile-image").value = "";
        el("update-bg-image").value = "";
      });

      el("update-images-submit").addEventListener("click", async () => {
        const groupId = el("update-images-group-id").value.trim();
        const profileImageFile = el("update-profile-image").files[0];
        const bgImageFile = el("update-bg-image").files[0];
        const msgEl = el("update-images-msg");

        if (!groupId) {
          showModalMsg(msgEl, "error", "Group ID is required");
          return;
        }

        if (!profileImageFile && !bgImageFile) {
          showModalMsg(msgEl, "error", "At least one image is required");
          return;
        }

        try {
          const url = `${BASE_URL}/group/image/update?id=${groupId}`;
          const formData = new FormData();
          if (profileImageFile)
            formData.append("profileImage", profileImageFile);
          if (bgImageFile) formData.append("bgImage", bgImageFile);

          const res = await fetch(url, {
            method: "PUT",
            headers: { Authorization: "Bearer " + getCurrentToken() },
            body: formData,
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showResult(body);
          showModalMsg(msgEl, "success", "Images updated successfully!");
          setTimeout(
            () => el("update-images-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // CHANGE Leader
      el("api-change-leader").addEventListener("click", () => {
        el("change-leader-modal").classList.remove("hidden");
        el("change-leader-group-id").value = "";
        el("change-leader-current-id").value = getCurrentUserId();
        el("change-leader-new-id").value = "";
      });

      el("change-leader-submit").addEventListener("click", async () => {
        const groupId = el("change-leader-group-id").value.trim();
        const currentLeaderId = el("change-leader-current-id").value.trim();
        const newLeaderId = el("change-leader-new-id").value.trim();
        const msgEl = el("change-leader-msg");

        if (!groupId || !currentLeaderId || !newLeaderId) {
          showModalMsg(msgEl, "error", "All fields are required");
          return;
        }

        try {
          const url = `${BASE_URL}/group/leader/change?groupId=${groupId}&currentLeaderId=${currentLeaderId}&newLeaderId=${newLeaderId}`;
          const res = await fetch(url, {
            method: "PUT",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showResult(body);
          showModalMsg(msgEl, "success", "Leader changed successfully!");
          setTimeout(
            () => el("change-leader-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // DELETE Group
      el("api-delete-group").addEventListener("click", () => {
        el("delete-group-modal").classList.remove("hidden");
        el("delete-group-id").value = "";
        el("delete-leader-id").value = getCurrentUserId();
      });

      el("delete-group-submit").addEventListener("click", async () => {
        const groupId = el("delete-group-id").value.trim();
        const leaderId = el("delete-leader-id").value.trim();
        const msgEl = el("delete-group-msg");

        if (!groupId || !leaderId) {
          showModalMsg(
            msgEl,
            "error",
            "Both Group ID and Leader ID are required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/group/delete?groupId=${groupId}&leaderId=${leaderId}`;
          const res = await fetch(url, {
            method: "DELETE",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body.message || `Failed (${res.status})`);
          }
          showResult("Group deleted successfully!");
          showModalMsg(msgEl, "success", "Group deleted!");
          setTimeout(
            () => el("delete-group-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // ==================== USER API TESTER FUNCTIONALITY ====================
      const userApiResult = el("user-api-result");

      function showUserResult(data, isError = false) {
        userApiResult.classList.remove("hidden");
        userApiResult.style.color = isError ? "#fca5a5" : "#86efac";
        userApiResult.textContent =
          typeof data === "string" ? data : JSON.stringify(data, null, 2);
      }

      // GET User
      el("api-get-user").addEventListener("click", () => {
        el("get-user-modal").classList.remove("hidden");
        el("get-user-id").value = getCurrentUserId();
        el("get-user-image").checked = false;
      });

      el("get-user-submit").addEventListener("click", async () => {
        const userId = el("get-user-id").value.trim();
        const includeImage = el("get-user-image").checked;
        const msgEl = el("get-user-msg");

        if (!userId) {
          showModalMsg(msgEl, "error", "User ID is required");
          return;
        }

        try {
          const url = `${BASE_URL}/user/profile/get?id=${userId}&image=${includeImage}`;
          const res = await fetch(url, {
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json();
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showUserResult(body);
          showModalMsg(msgEl, "success", "User retrieved successfully!");
          setTimeout(() => el("get-user-modal").classList.add("hidden"), 800);
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // FOLLOW User
      el("api-follow-user").addEventListener("click", () => {
        el("follow-user-modal").classList.remove("hidden");
        el("follow-user-id").value = getCurrentUserId();
        el("follow-target-id").value = "";
      });

      el("follow-user-submit").addEventListener("click", async () => {
        const userId = el("follow-user-id").value.trim();
        const targetId = el("follow-target-id").value.trim();
        const msgEl = el("follow-user-msg");

        if (!userId || !targetId) {
          showModalMsg(
            msgEl,
            "error",
            "Both User ID and Target ID are required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/user/${userId}/follow/${targetId}`;
          const res = await fetch(url, {
            method: "POST",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body.message || `Failed (${res.status})`);
          }
          showUserResult("Successfully followed user!");
          showModalMsg(msgEl, "success", "Followed successfully!");
          setTimeout(
            () => el("follow-user-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // UNFOLLOW User
      el("api-unfollow-user").addEventListener("click", () => {
        el("unfollow-user-modal").classList.remove("hidden");
        el("unfollow-user-id").value = getCurrentUserId();
        el("unfollow-target-id").value = "";
      });

      el("unfollow-user-submit").addEventListener("click", async () => {
        const userId = el("unfollow-user-id").value.trim();
        const targetId = el("unfollow-target-id").value.trim();
        const msgEl = el("unfollow-user-msg");

        if (!userId || !targetId) {
          showModalMsg(
            msgEl,
            "error",
            "Both User ID and Target ID are required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/user/${userId}/follow/${targetId}`;
          const res = await fetch(url, {
            method: "DELETE",
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body.message || `Failed (${res.status})`);
          }
          showUserResult("Successfully unfollowed user!");
          showModalMsg(msgEl, "success", "Unfollowed successfully!");
          setTimeout(
            () => el("unfollow-user-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // GET Followers
      el("api-get-followers").addEventListener("click", () => {
        el("get-followers-modal").classList.remove("hidden");
        el("get-followers-user-id").value = getCurrentUserId();
        el("get-followers-page").value = "0";
      });

      el("get-followers-submit").addEventListener("click", async () => {
        const userId = el("get-followers-user-id").value.trim();
        const page = el("get-followers-page").value.trim();
        const msgEl = el("get-followers-msg");

        if (!userId) {
          showModalMsg(msgEl, "error", "User ID is required");
          return;
        }

        try {
          const url = `${BASE_URL}/user/follower/list?id=${userId}&page=${page}`;
          const res = await fetch(url, {
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json();
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showUserResult(body);
          showModalMsg(msgEl, "success", "Followers retrieved successfully!");
          setTimeout(
            () => el("get-followers-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // GET Following
      el("api-get-following").addEventListener("click", () => {
        el("get-following-modal").classList.remove("hidden");
        el("get-following-user-id").value = getCurrentUserId();
        el("get-following-page").value = "0";
      });

      el("get-following-submit").addEventListener("click", async () => {
        const userId = el("get-following-user-id").value.trim();
        const page = el("get-following-page").value.trim();
        const msgEl = el("get-following-msg");

        if (!userId) {
          showModalMsg(msgEl, "error", "User ID is required");
          return;
        }

        try {
          const url = `${BASE_URL}/user/following/list?id=${userId}&page=${page}`;
          const res = await fetch(url, {
            headers: { Authorization: "Bearer " + getCurrentToken() },
          });
          const body = await res.json();
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showUserResult(body);
          showModalMsg(msgEl, "success", "Following retrieved successfully!");
          setTimeout(
            () => el("get-following-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // UPDATE User Profile
      el("api-update-profile").addEventListener("click", () => {
        el("update-user-profile-modal").classList.remove("hidden");
        el("update-profile-user-id").value = getCurrentUserId();
        el("update-profile-displayname").value = "";
        el("update-profile-bio").value = "";
        el("update-profile-location").value = "";
        el("update-profile-dob").value = "";
      });

      el("update-user-profile-submit").addEventListener("click", async () => {
        const userId = el("update-profile-user-id").value.trim();
        const displayName = el("update-profile-displayname").value.trim();
        const bio = el("update-profile-bio").value.trim();
        const location = el("update-profile-location").value.trim();
        const dateOfBirth = el("update-profile-dob").value;
        const msgEl = el("update-user-profile-msg");

        if (!userId) {
          showModalMsg(msgEl, "error", "User ID is required");
          return;
        }

        const updateData = {};
        if (displayName) updateData.displayName = displayName;
        if (bio) updateData.bio = bio;
        if (location) updateData.location = location;
        if (dateOfBirth) updateData.dateOfBirth = dateOfBirth;

        if (Object.keys(updateData).length === 0) {
          showModalMsg(
            msgEl,
            "error",
            "At least one field to update is required"
          );
          return;
        }

        try {
          const url = `${BASE_URL}/user/profile/update?id=${userId}`;
          const res = await fetch(url, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + getCurrentToken(),
            },
            body: JSON.stringify(updateData),
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showUserResult(body);
          showModalMsg(msgEl, "success", "Profile updated successfully!");
          setTimeout(
            () => el("update-user-profile-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });

      // UPDATE User Image
      el("api-update-user-image").addEventListener("click", () => {
        el("update-user-image-modal").classList.remove("hidden");
        el("update-user-image-id").value = getCurrentUserId();
        el("update-user-image-file").value = "";
      });

      el("update-user-image-submit").addEventListener("click", async () => {
        const userId = el("update-user-image-id").value.trim();
        const imageFile = el("update-user-image-file").files[0];
        const msgEl = el("update-user-image-msg");

        if (!userId) {
          showModalMsg(msgEl, "error", "User ID is required");
          return;
        }

        if (!imageFile) {
          showModalMsg(msgEl, "error", "Image file is required");
          return;
        }

        try {
          const url = `${BASE_URL}/user/profile/image/update?id=${userId}`;
          const formData = new FormData();
          formData.append("file", imageFile);

          const res = await fetch(url, {
            method: "PUT",
            headers: { Authorization: "Bearer " + getCurrentToken() },
            body: formData,
          });
          const body = await res.json().catch(() => ({}));
          if (!res.ok)
            throw new Error(body.message || `Failed (${res.status})`);
          showUserResult(body);
          showModalMsg(msgEl, "success", "Image updated successfully!");
          setTimeout(
            () => el("update-user-image-modal").classList.add("hidden"),
            800
          );
        } catch (err) {
          showUserResult(err.message, true);
          showModalMsg(msgEl, "error", err.message);
        }
      });
    </script>
  </body>
</html>
